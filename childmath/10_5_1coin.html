<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幼兒錢幣數學遊戲(5/10元版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1024px;
        }

        .coin {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: grab;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            touch-action: none;
            user-select: none;
        }

        .coin.one-yuan {
            background-color: #f7e6c4;
            border: 2px solid #d4a961;
            color: #d4a961;
        }
        
        .five-yuan-coin {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: #d1d5db;
            border: 2px solid #a1a1a1;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #4b5563;
        }

        .ten-yuan-coin {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background-color: #f9d949;
            border: 2px solid #d4a001;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #634002;
            font-size: 24px;
        }

        .dropzone {
            border: 2px dashed #9ca3af;
            background-color: #f9fafb;
            min-height: 250px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .dropzone.active {
            background-color: #e2e8f0;
            border-color: #3b82f6;
        }

        .coin-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        .right-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }

        .reset-button {
            padding: 12px 24px;
            background-color: #ef4444;
            color: white;
            border: none;
            border-radius: 9999px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, transform 0.3s;
        }

        .reset-button:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #4CAF50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body class="p-4">
    <div class="container mx-auto p-4 md:p-8 bg-white rounded-3xl shadow-lg">
        <h1 class="text-3xl md:text-4xl font-extrabold text-center text-gray-800 mb-6">錢幣魔法屋</h1>
        <p class="text-center text-gray-600 mb-8">請把 1 元硬幣拖曳到下方的框框裡，看看會發生什麼事！</p>

        <!-- 1元硬幣區域 -->
        <div id="coin-tray" class="flex flex-wrap justify-center gap-4 p-4 mb-8 bg-gray-100 rounded-2xl shadow-inner">
            <!-- JavaScript 會在這裡產生硬幣 -->
        </div>

        <!-- 放置區塊 -->
        <div class="flex flex-col md:flex-row justify-between items-stretch gap-6">
            <!-- 左邊放置區 -->
            <div id="left-dropzone" class="dropzone flex-1 rounded-2xl">
                <p class="text-gray-500 text-center mt-2">1 元硬幣放置區</p>
            </div>

            <!-- 等號 -->
            <div class="flex items-center justify-center p-4">
                <span class="text-5xl font-bold text-blue-600">=</span>
            </div>

            <!-- 右邊顯示區 -->
            <div id="right-display" class="right-section flex-1 rounded-2xl border-4 border-gray-300 p-4 bg-gray-200">
                <p class="text-gray-500 text-center mt-2">轉換區</p>
            </div>
        </div>

        <div class="mt-8 text-center">
            <button id="reset-button" class="reset-button">
                <i class="fas fa-redo-alt mr-2"></i>重來一次
            </button>
        </div>
    </div>

    <!-- Message Box -->
    <div id="message-box" class="message-box text-center">
        <p id="message-text">太棒了！</p>
    </div>

    <script>
        const coinTray = document.getElementById('coin-tray');
        const leftDropzone = document.getElementById('left-dropzone');
        const rightDisplay = document.getElementById('right-display');
        const resetButton = document.getElementById('reset-button');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');

        let droppedCoinsCount = 0;
        let isDragging = false;
        let draggedCoin = null;

        // 生成初始的 1 元硬幣
        function generateCoins() {
            for (let i = 0; i < 25; i++) {
                const coin = document.createElement('div');
                coin.classList.add('coin', 'one-yuan', 'draggable-item');
                coin.textContent = '1元';
                coin.draggable = true;
                coin.setAttribute('data-value', '1');
                coinTray.appendChild(coin);
            }
        }

        // 顯示訊息
        function showMessage(text, duration = 2000) {
            messageText.textContent = text;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, duration);
        }
        
        // 更新顯示的硬幣
        function updateRightSide() {
            rightDisplay.innerHTML = '<p class="text-gray-500 text-center mt-2">轉換區</p>';

            const tenYuanCount = Math.floor(droppedCoinsCount / 10);
            const remainder = droppedCoinsCount % 10;
            const fiveYuanCount = Math.floor(remainder / 5);

            const displayCoins = [];
            for(let i = 0; i < tenYuanCount; i++) {
                displayCoins.push({ value: 10, text: '10元', class: 'ten-yuan-coin' });
            }
            for(let i = 0; i < fiveYuanCount; i++) {
                displayCoins.push({ value: 5, text: '5元', class: 'five-yuan-coin' });
            }

            if (displayCoins.length > 0) {
                displayCoins.forEach(coin => {
                    const newCoin = document.createElement('div');
                    newCoin.classList.add(coin.class);
                    newCoin.textContent = coin.text;
                    rightDisplay.appendChild(newCoin);
                });
            }

            // 重新排列左邊的 1 元硬幣
            const oneYuanCoins = Array.from(leftDropzone.querySelectorAll('.coin'));
            leftDropzone.innerHTML = '<p class="text-gray-500 text-center mt-2">1 元硬幣放置區</p>';

            let rowContainer = document.createElement('div');
            rowContainer.classList.add('flex', 'flex-col', 'items-center', 'gap-2');
            leftDropzone.appendChild(rowContainer);

            let coinRow = document.createElement('div');
            coinRow.classList.add('coin-row');
            
            oneYuanCoins.forEach((coin, index) => {
                coinRow.appendChild(coin);
                if ((index + 1) % 5 === 0) {
                    rowContainer.appendChild(coinRow);
                    coinRow = document.createElement('div');
                    coinRow.classList.add('coin-row');
                }
            });

            if (coinRow.children.length > 0) {
                rowContainer.appendChild(coinRow);
            }

            // 檢查是否為 5 或 10 的倍數，並顯示訊息
            if (droppedCoinsCount % 10 === 0 && droppedCoinsCount > 0) {
                showMessage(`太棒了！您有 ${tenYuanCount} 個 10 元硬幣！`);
            } else if (droppedCoinsCount % 5 === 0 && droppedCoinsCount > 0) {
                 showMessage(`很棒！您有 ${fiveYuanCount} 個 5 元硬幣。`);
            }
        }

        // 重設遊戲
        function resetGame() {
            leftDropzone.innerHTML = '<p class="text-gray-500 text-center mt-2">1 元硬幣放置區</p>';
            rightDisplay.innerHTML = '<p class="text-gray-500 text-center mt-2">轉換區</p>';
            coinTray.innerHTML = '';
            droppedCoinsCount = 0;
            generateCoins();
        }

        // --- Drag and Drop Logic (for desktop) ---
        document.addEventListener('dragstart', (e) => {
            if (e.target.classList.contains('draggable-item')) {
                draggedCoin = e.target;
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', 'dragged');
                setTimeout(() => e.target.classList.add('opacity-50'), 0);
            }
        });

        document.addEventListener('dragend', (e) => {
            if (draggedCoin) {
                draggedCoin.classList.remove('opacity-50');
                draggedCoin = null;
            }
        });

        leftDropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            leftDropzone.classList.add('active');
        });

        leftDropzone.addEventListener('dragleave', (e) => {
            leftDropzone.classList.remove('active');
        });

        leftDropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            leftDropzone.classList.remove('active');
            
            if (draggedCoin) {
                const dropzoneRect = leftDropzone.getBoundingClientRect();
                if (e.clientX >= dropzoneRect.left && e.clientX <= dropzoneRect.right &&
                    e.clientY >= dropzoneRect.top && e.clientY <= dropzoneRect.bottom) {
                    
                    draggedCoin.parentNode.removeChild(draggedCoin);
                    leftDropzone.appendChild(draggedCoin);
                    droppedCoinsCount += 1;
                    updateRightSide();
                }
                draggedCoin = null;
            }
        });

        // --- Touch Events for mobile devices ---
        document.addEventListener('touchstart', (e) => {
            if (e.target.classList.contains('draggable-item')) {
                e.preventDefault();
                draggedCoin = e.target;
                
                const dropzoneRect = leftDropzone.getBoundingClientRect();

                const onMove = (e) => {
                    const touch = e.touches[0];
                    if (touch.clientX >= dropzoneRect.left && touch.clientX <= dropzoneRect.right &&
                        touch.clientY >= dropzoneRect.top && touch.clientY <= dropzoneRect.bottom) {
                        leftDropzone.classList.add('active');
                    } else {
                        leftDropzone.classList.remove('active');
                    }
                };

                const onEnd = (e) => {
                    document.removeEventListener('touchmove', onMove);
                    document.removeEventListener('touchend', onEnd);
                    
                    leftDropzone.classList.remove('active');
                    const touch = e.changedTouches[0];

                    if (touch.clientX >= dropzoneRect.left && touch.clientX <= dropzoneRect.right &&
                        touch.clientY >= dropzoneRect.top && touch.clientY <= dropzoneRect.bottom) {
                        
                        draggedCoin.parentNode.removeChild(draggedCoin);
                        leftDropzone.appendChild(draggedCoin);
                        droppedCoinsCount += 1;
                        updateRightSide();
                    }
                    draggedCoin = null;
                };

                document.addEventListener('touchmove', onMove, { passive: false });
                document.addEventListener('touchend', onEnd);
            }
        }, { passive: false });

        // 監聽重來一次按鈕
        resetButton.addEventListener('click', resetGame);

        // 初始化遊戲
        resetGame();
    </script>
</body>
</html>
