<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…ƒç´ é€±æœŸè¡¨è³“æœ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            touch-action: manipulation; /* é˜²æ­¢é›™æ“Šç¸®æ”¾ */
        }
        .bingo-card {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            aspect-ratio: 1 / 1;
        }
        .bingo-cell {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.75rem;
            font-weight: 600;
            border-radius: 0.5rem;
            background-color: #f1f5f9; /* slate-100 */
            color: #1e293b; /* slate-800 */
            transition: all 0.2s ease-in-out;
            border: 2px solid #cbd5e1; /* slate-300 */
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ */
            user-select: none;
            cursor: pointer; /* æ–°å¢é¼ æ¨™æŒ‡é‡ */
        }
        .bingo-cell:not(.marked):hover {
            background-color: #e2e8f0; /* slate-200 */
        }
        .bingo-cell.marked {
            background-color: #f59e0b; /* amber-500 */
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            border-color: #f59e0b; /* amber-500 */
            cursor: default;
        }
        .bingo-card.disabled .bingo-cell:not(.marked) {
            cursor: not-allowed;
            opacity: 0.6;
        }
        .bingo-cell.free {
            background-color: #10b981; /* emerald-500 */
            color: white;
            font-size: 1.25rem;
            border-color: #10b981; /* emerald-500 */
            cursor: default;
        }
        /* éŒ¯èª¤é»æ“Šçš„æ™ƒå‹•å‹•ç•« */
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
            border-color: #ef4444; /* red-500 */
        }
        /* é‡å°è¡Œå‹•è£ç½®å„ªåŒ–å­—é«”å¤§å° */
        @media (max-width: 640px) {
            .bingo-cell {
                font-size: 1rem; /* ä¸­æ–‡æ¨¡å¼ä¸‹å­—é«”ç¸®å° */
            }
             .bingo-cell.symbol-mode {
                font-size: 1.25rem; /* è‹±æ–‡æ¨¡å¼å­—é«” */
            }
            .bingo-cell.free {
                font-size: 0.875rem;
            }
        }
        /* å½ˆå‡ºè¦–çª—æ¨£å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 2rem 3rem;
            border-radius: 1rem;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-2xl mx-auto">
        <header class="text-center mb-6">
            <h1 class="text-4xl sm:text-5xl font-bold text-amber-400">å…ƒç´ é€±æœŸè¡¨è³“æœ</h1>
            <p id="subtitle" class="text-slate-300 mt-2">æŠ½å‡ºå…ƒç´ ï¼Œé»æ“Šå°æ‡‰çš„ç¬¦è™Ÿï¼</p>
        </header>

        <main class="bg-slate-800 p-4 sm:p-8 rounded-2xl shadow-2xl">
            <!-- éŠæˆ²è³‡è¨Šå€ -->
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                <div class="text-center">
                    <span class="text-sm text-slate-400">ç›®å‰æŠ½å‡º</span>
                    <div id="current-element" class="text-6xl font-bold text-white bg-slate-700 w-28 h-28 flex items-center justify-center rounded-lg mt-1 shadow-inner">
                        ?
                    </div>
                    <div id="attempts-tracker" class="text-slate-200 mt-2 font-semibold h-6"></div>
                </div>
                <div class="w-full sm:w-auto flex flex-col items-center gap-4">
                     <button id="draw-btn" class="w-full sm:w-48 bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-amber-300">
                        æŠ½å‡ºå…ƒç´ 
                    </button>
                    <button id="new-game-btn" class="w-full sm:w-48 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-emerald-300">
                        ç”¢ç”Ÿæ–°å¡ç‰‡
                    </button>
                     <button id="switch-mode-btn" class="w-full sm:w-48 bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-sky-300">
                        æ¨¡å¼: ä¸­ â†’ è‹±
                    </button>
                </div>
            </div>

            <!-- è³“æœå¡ -->
            <div id="bingo-card-container" class="bingo-card p-2 bg-slate-700 rounded-xl">
                <!-- Bingo cells will be generated by JavaScript -->
            </div>

            <!-- å·²æŠ½å‡ºå…ƒç´ åˆ—è¡¨ -->
            <div class="mt-6">
                <h3 class="text-lg font-semibold text-center mb-2 text-slate-300">å·²æŠ½å‡ºå…ƒç´  (<span id="called-count">0</span>/<span id="total-count">0</span>)</h3>
                <div id="called-elements-list" class="flex flex-wrap justify-center gap-2 p-3 bg-slate-900 rounded-lg min-h-[3rem]">
                    <!-- Called elements will appear here -->
                </div>
            </div>
        </main>
    </div>

    <!-- ç²å‹å½ˆå‡ºè¦–çª— -->
    <div id="win-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-4xl font-bold text-emerald-500 mb-2">ğŸ‰ è³“æœï¼ ğŸ‰</h2>
            <p class="text-slate-600 text-lg mb-6">æ­å–œä½ ï¼ŒæˆåŠŸé€£æˆä¸‰æ¢ç·šï¼</p>
            <button id="modal-new-game-btn" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-amber-300">
                å†ç©ä¸€å±€
            </button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM å…ƒç´ 
            const bingoCardContainer = document.getElementById('bingo-card-container');
            const drawBtn = document.getElementById('draw-btn');
            const newGameBtn = document.getElementById('new-game-btn');
            const switchModeBtn = document.getElementById('switch-mode-btn');
            const currentElementDisplay = document.getElementById('current-element');
            const calledElementsList = document.getElementById('called-elements-list');
            const calledCountSpan = document.getElementById('called-count');
            const totalCountSpan = document.getElementById('total-count');
            const winModal = document.getElementById('win-modal');
            const modalNewGameBtn = document.getElementById('modal-new-game-btn');
            const subtitle = document.getElementById('subtitle');
            const attemptsTracker = document.getElementById('attempts-tracker');

            // å…ƒç´ å°ç…§è¡¨ (å·²æ›´æ–°)
            const elementMap = {
                'æ°«': 'H', 'é‹°': 'Li', 'éˆ‰': 'Na', 'é‰€': 'K', 'éŠ£': 'Rb', 'éŠ«': 'Cs', 'é…': 'Fr',
                'éˆ¹': 'Be', 'é‚': 'Mg', 'éˆ£': 'Ca', 'é¶': 'Sr', 'é‹‡': 'Ba', 'é³': 'Ra',
                'ç¡¼': 'B', 'é‹': 'Al',
                'ç¢³': 'C', 'çŸ½': 'Si', 'éº': 'Ge', 'éŒ«': 'Sn', 'é‰›': 'Pb',
                'æ°®': 'N', 'ç£·': 'P',
                'æ°§': 'O', 'ç¡«': 'S',
                'æ°Ÿ': 'F', 'æ°¯': 'Cl', 'æº´': 'Br', 'ç¢˜': 'I',
                'æ°¦': 'He', 'æ°–': 'Ne', 'æ°¬': 'Ar', 'æ°ª': 'Kr', 'æ°™': 'Xe', 'æ°¡': 'Rn',
                'éŠ€': 'Ag', 'éŠ…': 'Cu', 'é‡‘': 'Au', 'éµ': 'Fe', 'éˆ¾': 'U', 'é‹…': 'Zn', 'éˆ¦': 'Ti', 'é‰»': 'Cr', 'éŒ³': 'Mn', 'éˆ·': 'Co', 'é³': 'Ni'
            };
            const symbolMap = Object.fromEntries(Object.entries(elementMap).map(([cn, en]) => [en, cn]));


            // éŠæˆ²å…ƒç´ æ±  (ä¸­æ–‡)
            const allElements = Object.keys(elementMap);
            const BINGO_SIZE = 5;
            const MAX_ATTEMPTS = 3;
            
            // éŠæˆ²ç‹€æ…‹
            let gameMode = 'cnToEn'; // 'cnToEn' (ä¸­â†’è‹±) or 'enToCn' (è‹±â†’ä¸­)
            let gameElementsPool = [];
            let cardState = [];
            let markedState = [];
            let isGameOver = false;
            let clickAttemptsLeft = 0;

            // åˆå§‹åŒ–éŠæˆ²
            function initGame() {
                isGameOver = false;
                gameElementsPool = shuffleArray([...allElements]); // æŠ½çæ± å›ºå®šç‚ºä¸­æ–‡
                cardState = generateCardData();
                markedState = Array(BINGO_SIZE).fill(0).map(() => Array(BINGO_SIZE).fill(false));
                markedState[2][2] = true; // ä¸­å¿ƒé»æ˜¯ FREE

                updateModeUI();
                renderCard();
                updateCalledElementsUI();
                
                clickAttemptsLeft = 0;
                attemptsTracker.textContent = '';
                bingoCardContainer.classList.remove('disabled');

                currentElementDisplay.textContent = '?';
                drawBtn.disabled = false;
                drawBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                winModal.classList.remove('visible');
            }

            // æ›´æ–°æ¨¡å¼ç›¸é—œçš„UI
            function updateModeUI() {
                if (gameMode === 'cnToEn') {
                    switchModeBtn.textContent = 'æ¨¡å¼: ä¸­ â†’ è‹±';
                    subtitle.textContent = 'æŠ½å‡ºä¸­æ–‡ï¼Œé»æ“Šå°æ‡‰çš„è‹±æ–‡ç¬¦è™Ÿï¼';
                } else {
                    switchModeBtn.textContent = 'æ¨¡å¼: è‹± â†’ ä¸­';
                    subtitle.textContent = 'æŠ½å‡ºè‹±æ–‡ç¬¦è™Ÿï¼Œé»æ“Šå°æ‡‰çš„ä¸­æ–‡ï¼';
                }
            }
            
            // æ´—ç‰Œæ¼”ç®—æ³• (Fisher-Yates)
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // ç”¢ç”Ÿè³“æœå¡æ•¸æ“š
            function generateCardData() {
                const itemsForCard = gameMode === 'cnToEn' ? Object.values(elementMap) : Object.keys(elementMap);
                const shuffled = shuffleArray([...itemsForCard]);
                const cardData = [];
                let elementIndex = 0;
                for (let i = 0; i < BINGO_SIZE; i++) {
                    const row = [];
                    for (let j = 0; j < BINGO_SIZE; j++) {
                        if (i === 2 && j === 2) {
                            row.push('FREE');
                        } else {
                            row.push(shuffled[elementIndex++]);
                        }
                    }
                    cardData.push(row);
                }
                return cardData;
            }

            // æ¸²æŸ“è³“æœå¡åˆ°ç•«é¢ä¸Š
            function renderCard() {
                bingoCardContainer.innerHTML = '';
                const isSymbolMode = gameMode === 'cnToEn';
                cardState.forEach((row, i) => {
                    row.forEach((element, j) => {
                        const cell = document.createElement('div');
                        cell.classList.add('bingo-cell');
                        if (isSymbolMode) {
                            cell.classList.add('symbol-mode');
                        }
                        cell.dataset.row = i;
                        cell.dataset.col = j;
                        cell.textContent = element;
                        if (element === 'FREE') {
                            cell.classList.add('free', 'marked');
                        }
                        bingoCardContainer.appendChild(cell);
                    });
                });
            }
            
            // æŠ½å‡ºä¸€å€‹æ–°å…ƒç´ 
            function drawElement() {
                if (isGameOver || gameElementsPool.length === 0) return;
                
                clickAttemptsLeft = MAX_ATTEMPTS;
                attemptsTracker.textContent = `å‰©é¤˜æ©Ÿæœƒ: ${clickAttemptsLeft}`;
                bingoCardContainer.classList.remove('disabled');

                const drawnChineseElement = gameElementsPool.pop();
                const displayElement = gameMode === 'cnToEn' ? drawnChineseElement : elementMap[drawnChineseElement];
                
                currentElementDisplay.textContent = displayElement;
                updateCalledElementsUI(drawnChineseElement);
            }

            // æ›´æ–°å·²æŠ½å‡ºå…ƒç´ çš„ UI
            function updateCalledElementsUI(newChineseElement = null) {
                if (newChineseElement) {
                    const elementSpan = document.createElement('span');
                    elementSpan.className = 'bg-slate-700 text-amber-300 font-semibold px-2 py-1 rounded text-sm';
                    const textToShow = gameMode === 'cnToEn' ? newChineseElement : elementMap[newChineseElement];
                    elementSpan.textContent = textToShow;
                    calledElementsList.appendChild(elementSpan);
                } else {
                    calledElementsList.innerHTML = '';
                }
                const calledCount = allElements.length - gameElementsPool.length;
                calledCountSpan.textContent = calledCount;
                totalCountSpan.textContent = allElements.length;
            }
            
            // è™•ç†å­¸ç”Ÿé»æ“Šæ ¼å­çš„äº‹ä»¶
            function handleCellClick(e) {
                const cell = e.target.closest('.bingo-cell');
                if (!cell || cell.classList.contains('marked') || isGameOver || clickAttemptsLeft <= 0) return;
                
                const currentDisplayedElement = currentElementDisplay.textContent;
                if (currentDisplayedElement === '?') return;

                let isCorrect = false;
                if (gameMode === 'cnToEn') {
                    const correctSymbol = elementMap[currentDisplayedElement];
                    isCorrect = cell.textContent === correctSymbol;
                } else { // 'enToCn'
                    const correctName = symbolMap[currentDisplayedElement];
                    isCorrect = cell.textContent === correctName;
                }
                
                if (isCorrect) {
                    const row = parseInt(cell.dataset.row);
                    const col = parseInt(cell.dataset.col);
                    cell.classList.add('marked');
                    markedState[row][col] = true;
                    
                    clickAttemptsLeft = 0; // ç­”å°äº†ï¼Œé–å®šé»æ“Š
                    attemptsTracker.textContent = 'âœ”ï¸ ç­”å°äº†ï¼';
                    bingoCardContainer.classList.add('disabled');
                    
                    setTimeout(checkBingo, 200);
                } else {
                    clickAttemptsLeft--;
                    attemptsTracker.textContent = `å‰©é¤˜æ©Ÿæœƒ: ${clickAttemptsLeft}`;
                    cell.classList.add('shake');
                    setTimeout(() => cell.classList.remove('shake'), 400);

                    if (clickAttemptsLeft <= 0) {
                        attemptsTracker.textContent = 'âŒ æ²’æœ‰æ©Ÿæœƒäº†ï¼';
                        bingoCardContainer.classList.add('disabled');
                    }
                }
            }

            // æª¢æŸ¥æ˜¯å¦é”æˆè³“æœ
            function checkBingo() {
                if (isGameOver) return;
                
                let completedLines = 0;
                // æª¢æŸ¥æ©«åˆ—
                for (let i = 0; i < BINGO_SIZE; i++) {
                    if (markedState[i].every(Boolean)) completedLines++;
                }
                // æª¢æŸ¥ç›´è¡Œ
                for (let j = 0; j < BINGO_SIZE; j++) {
                    if (markedState.map(row => row[j]).every(Boolean)) completedLines++;
                }
                // æª¢æŸ¥å°è§’ç·š
                if (markedState.map((row, i) => row[i]).every(Boolean)) completedLines++;
                if (markedState.map((row, i) => row[BINGO_SIZE - 1 - i]).every(Boolean)) completedLines++;

                if (completedLines >= 3) {
                    gameOver();
                }
            }
            
            function gameOver() {
                isGameOver = true;
                drawBtn.disabled = true;
                drawBtn.classList.add('opacity-50', 'cursor-not-allowed');
                winModal.classList.add('visible');
            }

            // åˆ‡æ›éŠæˆ²æ¨¡å¼
            function switchMode() {
                gameMode = gameMode === 'cnToEn' ? 'enToCn' : 'cnToEn';
                initGame();
            }

            // äº‹ä»¶ç›£è½
            drawBtn.addEventListener('click', drawElement);
            newGameBtn.addEventListener('click', initGame);
            switchModeBtn.addEventListener('click', switchMode);
            modalNewGameBtn.addEventListener('click', initGame);
            bingoCardContainer.addEventListener('click', handleCellClick);
            winModal.addEventListener('click', (e) => {
                if (e.target === winModal) {
                    winModal.classList.remove('visible');
                }
            });

            // éŠæˆ²é–‹å§‹
            initGame();
        });
    </script>
</body>
</html>

