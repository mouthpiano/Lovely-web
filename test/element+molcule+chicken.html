<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç†±ç²’é›å‹•ï¼šç§‘å­¸å¤§å†’éšª</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .no-select { user-select: none; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="no-select">
    <div id="root"></div>

    <script type="text/babel">
        // ============================================================================
        // ã€æ•™å¸«è¨­å®šå€ã€‘
        // è«‹å°‡æ‚¨çš„ Google Apps Script ç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€è²¼åœ¨ä¸‹æ–¹
        const TEACHER_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxSJdNEL-cG6CmSVJaHm3A_uerJYuLEVUjj3llmrk4NRq_zotkFBNzVusE3QmyjnflO/exec"; 
        // ============================================================================

        const { useState, useEffect, useRef, useMemo } = React;

        // --- å…±ç”¨å·¥å…·ï¼šLucide Icon (ä¿®æ­£ç‰ˆï¼šéš”é›¢ DOM æ“ä½œ) ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const containerRef = useRef(null);

            useEffect(() => {
                if (!containerRef.current || !window.lucide) return;
                containerRef.current.innerHTML = '';
                const iconElement = document.createElement('i');
                iconElement.setAttribute('data-lucide', name);
                containerRef.current.appendChild(iconElement);
                window.lucide.createIcons({
                    root: containerRef.current,
                    icons: { [name]: window.lucide.icons[name] },
                    nameAttr: 'data-lucide',
                    attrs: {
                        'stroke-width': 2,
                        width: size,
                        height: size,
                        class: `lucide lucide-${name} ${className}`
                    }
                });
            }, [name, size, className]);

            return <span ref={containerRef} style={{ display: 'inline-flex', alignItems: 'center', verticalAlign: 'middle' }}></span>;
        };

        // --- å…±ç”¨å…ƒä»¶ï¼šç‰ˆæ¬Šæ¨™ç¤º (Footer) ---
        const CopyrightFooter = () => (
            <div className="text-center py-4 text-xs text-gray-400 mt-8 border-t border-gray-200">
                <p>Designed by é»ƒéˆºå¿ƒ<br/>Gemini Canvasè¼”åŠ©ç”Ÿæˆ</p>
            </div>
        );

        // --- å…±ç”¨å…ƒä»¶ï¼šå³ä¸Šè§’æ¨™ç¤º ---
        const HeaderCredit = () => (
             <div className="text-[10px] text-gray-400 leading-tight text-right hidden sm:block">
                Designed by é»ƒéˆºå¿ƒ<br/>Gemini Canvasè¼”åŠ©ç”Ÿæˆ
            </div>
        );

        // ============================================================================
        // è³‡æ–™åº«å®šç¾©
        // ============================================================================

        // --- é—œå¡ 1: çƒ¤é› è³‡æ–™ ---
        const CHICKEN_IMAGES = {
            intro: "img1.jpg", q1: "img2.jpg", q2: "img3.jpg", q3: "img4.jpg", q4: "img5.jpg", q5: "img5.jpg", win: "img1.jpg", lose: "img6.jpg"
        };

        const CHICKEN_QUESTIONS = [
            { id: 'q1', title: "ç¬¬ä¸€æ­¥ï¼šç®±å…§é‹ªè¨­é‹ç®”ç´™", description: "åœ¨ç´™ç®±å…§éƒ¨é‹ªæ»¿é‹ç®”ç´™ï¼Œä¸»è¦æ˜¯åˆ©ç”¨é‡‘å±¬é‹ç®”å¯ä»¥é˜²æ­¢ç†±ä»¥å“ªç¨®æ–¹å¼æ•£å¤±ï¼Ÿ", imgKey: "q1", options: [{ text: "ç†±å‚³å°", correct: false, feedback: "é‡‘å±¬æ˜¯è‰¯å°é«”ï¼Œé‹ªé‹ç®”ä¸»è¦ä¸æ˜¯é˜²å‚³å°ã€‚" }, { text: "ç†±å°æµ", correct: false, feedback: "é‹ç®”çš„ä¸»è¦åŠŸèƒ½æ˜¯åå°„æ³¢å‹•ï¼Œä¸æ˜¯é˜»éš”ç©ºæ°£å¾ªç’°ã€‚" }, { text: "ç†±è¼»å°„", correct: true, feedback: "æ²’éŒ¯ï¼é‹ç®”èƒ½åå°„ç†±è¼»å°„ï¼Œå°±åƒä¸€é¢ç†±èƒ½é¡å­æŠŠç†±å½ˆå›å»ï¼" }] },
            { id: 'q2', title: "ç¬¬äºŒæ­¥ï¼šé–‹å­”èˆ‡å°æµè¨­è¨ˆ", description: "æˆ‘å€‘åœ¨ç´™ç®±ä¸Šæ–¹é–‹æ´ï¼Œä¸¦åœ¨ç´™ç®±å¦ä¸€å´ä¸‹æ–¹é–‹æ´ã€‚é€™ç¨®ã€Œä¸‹é€²ä¸Šå‡ºã€çš„è¨­è¨ˆæ˜¯ç‚ºäº†è®“ç©ºæ°£ç”¢ç”Ÿä»€éº¼ç¾è±¡ï¼Ÿ", imgKey: "q2", options: [{ text: "ç†±å°æµ", correct: true, feedback: "è³“æœï¼å†·ç©ºæ°£ä¸‹é€²ã€ç†±ç©ºæ°£ä¸Šå‡ºï¼Œå¾ªç’°å¸¶å‹•ç†±èƒ½ï¼Œé€™å°±æ˜¯å°æµï¼" }, { text: "ç†±è¼»å°„", correct: false, feedback: "é–‹æ´ä¸»è¦æ˜¯ç‚ºäº†è®“ç©ºæ°£æµå‹•ï¼Œè¼»å°„ä¸éœ€è¦ç©ºæ°£ä»‹è³ªã€‚" }, { text: "ç†±å‚³å°", correct: false, feedback: "æ°£é«”ä¹‹é–“çš„å‚³ç†±ä¸»è¦é æµå‹•ï¼ˆå°æµï¼‰è€Œéç›´æ¥å‚³å°ã€‚" }] },
            { id: 'q3', title: "ç¬¬ä¸‰æ­¥ï¼šæ¶èµ·å…¨é›", description: "ä½¿ç”¨ã€Œé‡‘å±¬çƒ¤è‚‰ç±¤ã€ç©¿éé›è‚‰ä¸¦æ¶åœ¨ç´™ç®±ä¸Šã€‚ç†±æœƒé †è‘—é‡‘å±¬ç±¤å‚³åˆ°é›è‚‰å…§éƒ¨ï¼Œé€™æ˜¯ä»€éº¼åŸç†ï¼Ÿ", imgKey: "q3", options: [{ text: "ç†±å‚³å°", correct: true, feedback: "ç­”å°äº†ï¼é‡‘å±¬ç±¤ç›´æ¥æ¥è§¸é›è‚‰ï¼Œç†±èƒ½æ²¿è‘—å›ºé«”å‚³éï¼Œæ•ˆç‡éå¸¸é«˜ï¼" }, { text: "ç†±å°æµ", correct: false, feedback: "é€™æ˜¯å›ºé«”é–“çš„ç†±å‚³æ’­ï¼Œä¸æ˜¯æµé«”æµå‹•ã€‚" }, { text: "ç†±è¼»å°„", correct: false, feedback: "é€™æ˜¯æ¥è§¸å‚³ç†±ï¼Œä¸æ˜¯é€éé›»ç£æ³¢å‚³éã€‚" }] },
            { id: 'q4', title: "ç¬¬å››æ­¥ï¼šç”Ÿæ´»æ‡‰ç”¨è¯æƒ³ï¼ˆä¸€ï¼‰", description: "ç´™ç®±çƒ¤è‚‰åˆ©ç”¨ã€ç©ºæ°£å±¤ã€å’Œã€é‹ç®”åå°„ã€ä¾†ä¿æº«ã€‚é€™èˆ‡æ—¥å¸¸ç”Ÿæ´»ä¸­å“ªç¨®ç‰©å“çš„è¨­è¨ˆåŸç†æœ€ç›¸ä¼¼ï¼Ÿ", imgKey: "q4", options: [{ text: "æš–æš–åŒ…", correct: false, feedback: "æš–æš–åŒ…æ˜¯åŒ–å­¸ç”¢ç†±ï¼Œä¸æ˜¯åˆ©ç”¨é˜»çµ•å‚³æ’­ä¾†ä¿æº«ã€‚" }, { text: "ä¿æº«ç“¶", correct: true, feedback: "å®Œå…¨æ­£ç¢ºï¼çœŸç©ºå±¤æ“‹å°æµå‚³å°ï¼ŒééŠ€å±¤åå°„ç†±è¼»å°„ï¼" }, { text: "é›»ç†±æ¯¯", correct: false, feedback: "é›»ç†±æ¯¯æ˜¯é›»èƒ½è½‰ç†±èƒ½ã€‚" }] },
            { id: 'q5', title: "ç¬¬äº”æ­¥ï¼šç”Ÿæ´»æ‡‰ç”¨è¯æƒ³ï¼ˆäºŒï¼‰", description: "é—œæ–¼ã€ç†±å°æµã€çš„ç”Ÿæ´»æ‡‰ç”¨ï¼Œä¸‹åˆ—å“ªä¸€å€‹ä¾‹å­èˆ‡ç´™ç®±é–‹æ´çš„åŸç†æœ€ç‚ºé¡ä¼¼ï¼Ÿ", imgKey: "q5", options: [{ text: "å¤å¤©ç©¿æ·ºè‰²è¡£æœæ¯”è¼ƒæ¶¼å¿«", correct: false, feedback: "é€™æ˜¯ç†±è¼»å°„çš„æ‡‰ç”¨ï¼ˆæ¸›å°‘å¸æ”¶ï¼‰ã€‚" }, { text: "ç’°ä¿é‡‘çˆ", correct: true, feedback: "æ­£ç¢ºï¼ç’°ä¿é‡‘çˆçš„é‡‘ç´™å—ç†±å¾Œç”¢ç”Ÿç†±ç©ºæ°£ä¸Šå‡ï¼Œå†·ç©ºæ°£ç”±ä¸‹æ–¹å¸å…¥è£œå……ï¼Œå½¢æˆå¾ªç’°æ°£æµï¼Œç¢ºä¿æ°§æ°£æŒçºŒä¾›æ‡‰ã€‚" }, { text: "æ‰‹ç¢°åˆ°ç†±é‹å­è¢«ç‡™å‚·", correct: false, feedback: "é€™æ˜¯ç†±å‚³å°çš„ç¾è±¡ã€‚" }] }
        ];

        // --- é—œå¡ 2: å…ƒç´  è³‡æ–™ ---
        const ELEM_TAGS = {
            SYM_AU: { id: 'Au', text: 'Au', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_AG: { id: 'Ag', text: 'Ag', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_CU: { id: 'Cu', text: 'Cu', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_FE: { id: 'Fe', text: 'Fe', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_AL: { id: 'Al', text: 'Al', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_HG: { id: 'Hg', text: 'Hg', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_SI: { id: 'Si', text: 'Si', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_C: { id: 'C', text: 'C', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_NA: { id: 'Na', text: 'Na', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_K: { id: 'K', text: 'K', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_MG: { id: 'Mg', text: 'Mg', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_CA: { id: 'Ca', text: 'Ca', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_HE: { id: 'He', text: 'He', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_NE: { id: 'Ne', text: 'Ne', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_H: { id: 'H', text: 'H', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_O: { id: 'O', text: 'O', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_CL: { id: 'Cl', text: 'Cl', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_BR: { id: 'Br', text: 'Br', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_I: { id: 'I', text: 'I', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_S: { id: 'S', text: 'S', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_P: { id: 'P', text: 'P', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_CR: { id: 'Cr', text: 'Cr', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_NI: { id: 'Ni', text: 'Ni', category: 'å…ƒç´ ç¬¦è™Ÿ' }, SYM_ZN: { id: 'Zn', text: 'Zn', category: 'å…ƒç´ ç¬¦è™Ÿ' },
            SOLID: { id: 'solid', text: 'å›ºæ…‹', category: 'ç‹€æ…‹' }, LIQUID: { id: 'liquid', text: 'æ¶²æ…‹', category: 'ç‹€æ…‹' }, GAS: { id: 'gas', text: 'æ°£æ…‹', category: 'ç‹€æ…‹' },
            METAL: { id: 'metal', text: 'é‡‘å±¬å…ƒç´ ', category: 'åˆ†é¡' }, NON_METAL: { id: 'non_metal', text: 'éé‡‘å±¬å…ƒç´ ', category: 'åˆ†é¡' }, ALLOY: { id: 'alloy', text: 'åˆé‡‘(æ··åˆç‰©)', category: 'åˆ†é¡' }, ALKALI_METAL: { id: 'alkali_m', text: 'é¹¼é‡‘å±¬ (ç¬¬1æ—)', category: 'åˆ†é¡' }, ALKALI_EARTH: { id: 'alkali_e', text: 'é¹¼åœŸé‡‘å±¬ (ç¬¬2æ—)', category: 'åˆ†é¡' }, NOBLE_GAS: { id: 'noble', text: 'éˆæ°£ (ç¬¬18æ—)', category: 'åˆ†é¡' },
            SILVER_COLOR: { id: 'silver', text: 'éŠ€ç°è‰²/éŠ€ç™½è‰²', category: 'å¤–è§€' }, GOLD_COLOR: { id: 'gold_c', text: 'é‡‘é»ƒè‰²/é»ƒè‰²', category: 'å¤–è§€' }, RED_COLOR: { id: 'red_c', text: 'ç´…è¤è‰²/ç´…è‰²', category: 'å¤–è§€' }, BLACK_COLOR: { id: 'black_c', text: 'é»‘è‰²/æ·±ç°è‰²', category: 'å¤–è§€' }, TRANSPARENT: { id: 'trans', text: 'é€æ˜ç„¡è‰²', category: 'å¤–è§€' }, YELLOW_GREEN: { id: 'y_green', text: 'é»ƒç¶ è‰²', category: 'å¤–è§€' }, LUSTER: { id: 'luster', text: 'å…·é‡‘å±¬å…‰æ¾¤', category: 'å¤–è§€' }, NO_LUSTER: { id: 'no_luster', text: 'ç„¡é‡‘å±¬å…‰æ¾¤', category: 'å¤–è§€' },
            CONDUCTOR: { id: 'conductor', text: 'å¯å°é›»', category: 'æ€§è³ª <å¸¸æº«>' }, BEST_CONDUCTOR: { id: 'cond_1', text: 'å°é›»æ€§æœ€ä½³', category: 'æ€§è³ª <å¸¸æº«>' }, SECOND_CONDUCTOR: { id: 'cond_2', text: 'å°é›»æ€§ç¬¬2å', category: 'æ€§è³ª <å¸¸æº«>' }, INSULATOR: { id: 'insulator', text: 'é›»/ç†±ä¸è‰¯å°é«”', category: 'æ€§è³ª <å¸¸æº«>' }, SEMICONDUCTOR: { id: 'semi', text: 'åŠå°é«”', category: 'æ€§è³ª <å¸¸æº«>' }, DUCTILE: { id: 'ductile', text: 'å…·å»¶æ€§/å±•æ€§', category: 'æ€§è³ª <å¸¸æº«>' }, BEST_DUCTILITY: { id: 'duct_1', text: 'å»¶å±•æ€§æœ€ä½³', category: 'æ€§è³ª <å¸¸æº«>' }, BRITTLE: { id: 'brittle', text: 'æ˜“ç¢/ä¸å…·å»¶å±•æ€§', category: 'æ€§è³ª <å¸¸æº«>' }, SOFT: { id: 'soft', text: 'è³ªåœ°è»Ÿ(å¯ç”¨åˆ€åˆ‡)', category: 'æ€§è³ª <å¸¸æº«>' }, HARDEST: { id: 'hardest', text: 'è‡ªç„¶ç•Œæœ€ç¡¬ç‰©è³ª', category: 'æ€§è³ª <å¸¸æº«>' }, LOW_HARDNESS: { id: 'low_hard', text: 'ç¡¬åº¦å°/æ»‘è†©', category: 'æ€§è³ª <å¸¸æº«>' }, MAGNETIC: { id: 'magnetic', text: 'å…·ç£æ€§/æ˜“ç”Ÿé½', category: 'æ€§è³ª <å¸¸æº«>' }, LIGHT_DENSITY: { id: 'light', text: 'å¯†åº¦å°/è¼•', category: 'æ€§è³ª <å¸¸æº«>' }, POROUS: { id: 'porous', text: 'å¤šå­”éš™/å¸é™„æ€§ä½³', category: 'æ€§è³ª <å¸¸æº«>' },
            WATER_REACT_BASE: { id: 'w_base', text: 'é‡æ°´åæ‡‰å‘ˆé¹¼æ€§', category: 'åŒ–å­¸/å…¶ä»–' }, PHENOL_RED: { id: 'p_red', text: 'åæ‡‰å¾Œé…šé…å‘ˆç´…è‰²', category: 'åŒ–å­¸/å…¶ä»–' }, RUST_PROTECT: { id: 'protect', text: 'æ°§åŒ–å±¤ç·»å¯†/é˜²é½', category: 'åŒ–å­¸/å…¶ä»–' }, CRUST_1: { id: 'crust_1', text: 'åœ°æ®¼å«é‡ç¬¬1å', category: 'åŒ–å­¸/å…¶ä»–' }, CRUST_2: { id: 'crust_2', text: 'åœ°æ®¼å«é‡ç¬¬2å', category: 'åŒ–å­¸/å…¶ä»–' }, WIRES: { id: 'wires', text: 'å°ç·šææ–™', category: 'ç”¨é€”/æˆåˆ†' }, JEWELRY: { id: 'jewelry', text: 'é£¾å“/è²¨å¹£', category: 'ç”¨é€”/æˆåˆ†' }, CHIPS: { id: 'chips', text: 'æ™¶ç‰‡åŸæ–™', category: 'ç”¨é€”/æˆåˆ†' }, STEEL_RAW: { id: 'steel_raw', text: 'ç…‰é‹¼åŸæ–™', category: 'ç”¨é€”/æˆåˆ†' }, THERMOMETER: { id: 'thermo', text: 'æº«åº¦è¨ˆ/æ°£å£“è¨ˆ', category: 'ç”¨é€”/æˆåˆ†' }, BALLOON: { id: 'balloon', text: 'å¡«å……æ°£çƒ/é£›èˆ¹', category: 'ç”¨é€”/æˆåˆ†' }, NEON: { id: 'neon', text: 'éœ“è™¹ç‡ˆ', category: 'ç”¨é€”/æˆåˆ†' }, PENCIL: { id: 'pencil', text: 'ç­†èŠ¯/é›»æ± é›»æ¥µ', category: 'ç”¨é€”/æˆåˆ†' }, CUTTING: { id: 'cutting', text: 'åˆ‡å‰²ç»ç’ƒ', category: 'ç”¨é€”/æˆåˆ†' }, ALLOY_FE_CR_NI: { id: 'a_fe_cr_ni', text: 'éµ+é‰»+é³ åˆé‡‘', category: 'ç”¨é€”/æˆåˆ†' }, ALLOY_CU_ZN: { id: 'a_cu_zn', text: 'éŠ…+é‹… åˆé‡‘', category: 'ç”¨é€”/æˆåˆ†' }, ALLOY_AU_AG: { id: 'a_au_ag', text: 'é‡‘+éŠ€+éŠ… åˆé‡‘', category: 'ç”¨é€”/æˆåˆ†' },
        };

        const ELEMENTS_DB = [
            { name: "é‡‘", tags: [ELEM_TAGS.SYM_AU, ELEM_TAGS.SOLID, ELEM_TAGS.METAL, ELEM_TAGS.GOLD_COLOR, ELEM_TAGS.LUSTER, ELEM_TAGS.CONDUCTOR, ELEM_TAGS.DUCTILE, ELEM_TAGS.BEST_DUCTILITY, ELEM_TAGS.JEWELRY, ELEM_TAGS.WIRES, ELEM_TAGS.ALLOY_AU_AG] },
            { name: "éŠ€", tags: [ELEM_TAGS.SYM_AG, ELEM_TAGS.SOLID, ELEM_TAGS.METAL, ELEM_TAGS.SILVER_COLOR, ELEM_TAGS.LUSTER, ELEM_TAGS.CONDUCTOR, ELEM_TAGS.BEST_CONDUCTOR, ELEM_TAGS.DUCTILE, ELEM_TAGS.JEWELRY, ELEM_TAGS.WIRES, ELEM_TAGS.ALLOY_AU_AG] },
            { name: "éŠ…", tags: [ELEM_TAGS.SYM_CU, ELEM_TAGS.SOLID, ELEM_TAGS.METAL, ELEM_TAGS.RED_COLOR, ELEM_TAGS.LUSTER, ELEM_TAGS.CONDUCTOR, ELEM_TAGS.SECOND_CONDUCTOR, ELEM_TAGS.DUCTILE, ELEM_TAGS.WIRES, ELEM_TAGS.JEWELRY, ELEM_TAGS.ALLOY_CU_ZN, ELEM_TAGS.ALLOY_AU_AG] },
            { name: "éµ", tags: [ELEM_TAGS.SYM_FE, ELEM_TAGS.SOLID, ELEM_TAGS.METAL, ELEM_TAGS.SILVER_COLOR, ELEM_TAGS.LUSTER, ELEM_TAGS.CONDUCTOR, ELEM_TAGS.DUCTILE, ELEM_TAGS.MAGNETIC, ELEM_TAGS.STEEL_RAW, ELEM_TAGS.ALLOY_FE_CR_NI] },
            { name: "é‹", tags: [ELEM_TAGS.SYM_AL, ELEM_TAGS.SOLID, ELEM_TAGS.METAL, ELEM_TAGS.SILVER_COLOR, ELEM_TAGS.LUSTER, ELEM_TAGS.CONDUCTOR, ELEM_TAGS.DUCTILE, ELEM_TAGS.LIGHT_DENSITY, ELEM_TAGS.RUST_PROTECT, ELEM_TAGS.WIRES, ELEM_TAGS.JEWELRY] },
            { name: "æ± (æ°´éŠ€)", tags: [ELEM_TAGS.SYM_HG, ELEM_TAGS.LIQUID, ELEM_TAGS.METAL, ELEM_TAGS.SILVER_COLOR, ELEM_TAGS.LUSTER, ELEM_TAGS.CONDUCTOR, ELEM_TAGS.THERMOMETER] },
            { name: "çŸ½", tags: [ELEM_TAGS.SYM_SI, ELEM_TAGS.SOLID, ELEM_TAGS.NON_METAL, ELEM_TAGS.BLACK_COLOR, ELEM_TAGS.LUSTER, ELEM_TAGS.SEMICONDUCTOR, ELEM_TAGS.BRITTLE, ELEM_TAGS.CHIPS, ELEM_TAGS.CRUST_2] },
            { name: "æ´»æ€§ç¢³", tags: [ELEM_TAGS.SYM_C, ELEM_TAGS.SOLID, ELEM_TAGS.NON_METAL, ELEM_TAGS.BLACK_COLOR, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.POROUS, ELEM_TAGS.INSULATOR, ELEM_TAGS.BRITTLE] },
            { name: "é‘½çŸ³", tags: [ELEM_TAGS.SYM_C, ELEM_TAGS.SOLID, ELEM_TAGS.NON_METAL, ELEM_TAGS.TRANSPARENT, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.INSULATOR, ELEM_TAGS.HARDEST, ELEM_TAGS.JEWELRY, ELEM_TAGS.CUTTING] },
            { name: "çŸ³å¢¨", tags: [ELEM_TAGS.SYM_C, ELEM_TAGS.SOLID, ELEM_TAGS.NON_METAL, ELEM_TAGS.BLACK_COLOR, ELEM_TAGS.CONDUCTOR, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.LOW_HARDNESS, ELEM_TAGS.PENCIL] },
            { name: "æº´", tags: [ELEM_TAGS.SYM_BR, ELEM_TAGS.LIQUID, ELEM_TAGS.NON_METAL, ELEM_TAGS.RED_COLOR, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.INSULATOR] },
            { name: "æ°¯", tags: [ELEM_TAGS.SYM_CL, ELEM_TAGS.GAS, ELEM_TAGS.NON_METAL, ELEM_TAGS.YELLOW_GREEN, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.INSULATOR] },
            { name: "ç¢˜", tags: [ELEM_TAGS.SYM_I, ELEM_TAGS.SOLID, ELEM_TAGS.NON_METAL, ELEM_TAGS.BLACK_COLOR, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.INSULATOR, ELEM_TAGS.BRITTLE, ELEM_TAGS.LOW_HARDNESS] },
            { name: "ç¡«", tags: [ELEM_TAGS.SYM_S, ELEM_TAGS.SOLID, ELEM_TAGS.NON_METAL, ELEM_TAGS.GOLD_COLOR, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.INSULATOR, ELEM_TAGS.BRITTLE, ELEM_TAGS.LOW_HARDNESS] },
            { name: "ç´…ç£·", tags: [ELEM_TAGS.SYM_P, ELEM_TAGS.SOLID, ELEM_TAGS.NON_METAL, ELEM_TAGS.RED_COLOR, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.INSULATOR, ELEM_TAGS.BRITTLE, ELEM_TAGS.LOW_HARDNESS] },
            { name: "æ°«", tags: [ELEM_TAGS.SYM_H, ELEM_TAGS.GAS, ELEM_TAGS.NON_METAL, ELEM_TAGS.TRANSPARENT, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.INSULATOR, ELEM_TAGS.LIGHT_DENSITY] },
            { name: "æ°§", tags: [ELEM_TAGS.SYM_O, ELEM_TAGS.GAS, ELEM_TAGS.NON_METAL, ELEM_TAGS.TRANSPARENT, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.INSULATOR, ELEM_TAGS.CRUST_1] },
            { name: "æ°¦", tags: [ELEM_TAGS.SYM_HE, ELEM_TAGS.GAS, ELEM_TAGS.NON_METAL, ELEM_TAGS.NOBLE_GAS, ELEM_TAGS.TRANSPARENT, ELEM_TAGS.NO_LUSTER, ELEM_TAGS.INSULATOR, ELEM_TAGS.LIGHT_DENSITY, ELEM_TAGS.BALLOON] },
            { name: "éˆ‰", tags: [ELEM_TAGS.SYM_NA, ELEM_TAGS.SOLID, ELEM_TAGS.METAL, ELEM_TAGS.ALKALI_METAL, ELEM_TAGS.SILVER_COLOR, ELEM_TAGS.LUSTER, ELEM_TAGS.CONDUCTOR, ELEM_TAGS.SOFT, ELEM_TAGS.LIGHT_DENSITY, ELEM_TAGS.WATER_REACT_BASE, ELEM_TAGS.PHENOL_RED, ELEM_TAGS.DUCTILE] },
            { name: "ä¸é½é‹¼", tags: [ELEM_TAGS.SYM_FE, ELEM_TAGS.SYM_CR, ELEM_TAGS.SYM_NI, ELEM_TAGS.SOLID, ELEM_TAGS.ALLOY, ELEM_TAGS.SILVER_COLOR, ELEM_TAGS.LUSTER, ELEM_TAGS.CONDUCTOR, ELEM_TAGS.DUCTILE, ELEM_TAGS.ALLOY_FE_CR_NI, ELEM_TAGS.RUST_PROTECT] },
            { name: "é»ƒéŠ…", tags: [ELEM_TAGS.SYM_CU, ELEM_TAGS.SYM_ZN, ELEM_TAGS.SOLID, ELEM_TAGS.ALLOY, ELEM_TAGS.GOLD_COLOR, ELEM_TAGS.LUSTER, ELEM_TAGS.CONDUCTOR, ELEM_TAGS.DUCTILE, ELEM_TAGS.ALLOY_CU_ZN, ELEM_TAGS.JEWELRY] }
        ];

        // --- é—œå¡ 3: åˆ†å­ è³‡æ–™ ---
        const MOL_ATOM_TYPES = {
            H: { color: 'bg-white border-gray-400', label: 'æ°«' },
            O: { color: 'bg-red-500 border-red-700', label: 'æ°§' },
            C: { color: 'bg-gray-900 border-gray-700', label: 'ç¢³' },
        };
        const MOL_OPTIONS = [
            { id: 'opt_2H', type: '2H', description: 'å…©é¡†åˆ†é–‹çš„æ°«åŸå­' }, { id: 'opt_2H2', type: '2Hâ‚‚', description: 'å…©å€‹æ°«åˆ†å­' },
            { id: 'opt_CO2', type: 'COâ‚‚', description: 'äºŒæ°§åŒ–ç¢³åˆ†å­' }, { id: 'opt_H2O', type: 'Hâ‚‚O', description: 'æ°´åˆ†å­' },
            { id: 'opt_O', type: 'O', description: 'æ°§åŸå­' }, { id: 'opt_O2', type: 'Oâ‚‚', description: 'æ°§åˆ†å­' },
            { id: 'opt_2H2O', type: '2Hâ‚‚O', description: 'å…©å€‹æ°´åˆ†å­' }, { id: 'opt_Mix', type: 'Hâ‚‚+COâ‚‚', description: 'æ°«æ°£èˆ‡äºŒæ°§åŒ–ç¢³æ··åˆ' }
        ];
        const MOL_QUESTIONS = [
            { id: 'q1', symbol: '2H', correctModelId: 'opt_2H', correct: { count: 2, name: 'æ°«åŸå­', category: 'å…ƒç´ ', purity: 'ç´”ç‰©è³ª', composition: { totalAtoms: 2, atomTypes: 1, moleculeCount: 0, moleculeTypes: 0 } } },
            { id: 'q2', symbol: '2Hâ‚‚', correctModelId: 'opt_2H2', correct: { count: 2, name: 'æ°«åˆ†å­', category: 'å…ƒç´ ', purity: 'ç´”ç‰©è³ª', composition: { totalAtoms: 4, atomTypes: 1, moleculeCount: 2, moleculeTypes: 1 } } },
            { id: 'q3', symbol: 'COâ‚‚', correctModelId: 'opt_CO2', correct: { count: 1, name: 'äºŒæ°§åŒ–ç¢³åˆ†å­', category: 'åŒ–åˆç‰©', purity: 'ç´”ç‰©è³ª', composition: { totalAtoms: 3, atomTypes: 2, moleculeCount: 1, moleculeTypes: 1 } } },
            { id: 'q4', symbol: 'Hâ‚‚O', correctModelId: 'opt_H2O', correct: { count: 1, name: 'æ°´åˆ†å­', category: 'åŒ–åˆç‰©', purity: 'ç´”ç‰©è³ª', composition: { totalAtoms: 3, atomTypes: 2, moleculeCount: 1, moleculeTypes: 1 } } },
            { id: 'q5', symbol: 'O', correctModelId: 'opt_O', correct: { count: 1, name: 'æ°§åŸå­', category: 'å…ƒç´ ', purity: 'ç´”ç‰©è³ª', composition: { totalAtoms: 1, atomTypes: 1, moleculeCount: 0, moleculeTypes: 0 } } },
            { id: 'q6', symbol: 'Oâ‚‚', correctModelId: 'opt_O2', correct: { count: 1, name: 'æ°§åˆ†å­', category: 'å…ƒç´ ', purity: 'ç´”ç‰©è³ª', composition: { totalAtoms: 2, atomTypes: 1, moleculeCount: 1, moleculeTypes: 1 } } },
            { id: 'q7', symbol: '2Hâ‚‚O', correctModelId: 'opt_2H2O', correct: { count: 2, name: 'æ°´åˆ†å­', category: 'åŒ–åˆç‰©', purity: 'ç´”ç‰©è³ª', composition: { totalAtoms: 6, atomTypes: 2, moleculeCount: 2, moleculeTypes: 1 } } },
            { id: 'q8', symbol: 'Hâ‚‚ + COâ‚‚', correctModelId: 'opt_Mix', correct: { count: 2, name: 'æ··åˆç‰©(æœ‰å¹¾å€‹ç‰©è³ª)', category: 'ä¸é©ç”¨', purity: 'æ··åˆç‰©', composition: { totalAtoms: 5, atomTypes: 3, moleculeCount: 2, moleculeTypes: 2 } } }
        ];

        // ============================================================================
        // æ¸²æŸ“å…ƒä»¶ (Level Components)
        // ============================================================================

        // --- ç™»å…¥ç•«é¢ ---
        const LoginScreen = ({ onLogin }) => {
            const [info, setInfo] = useState({ class: '', number: '', name: '' });
            
            const handleSubmit = () => {
                if(info.class && info.number && info.name) onLogin(info);
                else alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š');
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center p-4">
                    <div className="fixed top-4 right-4 z-50">
                        <HeaderCredit />
                    </div>
                    <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in relative">
                        <div className="text-center mb-8">
                            <h1 className="text-3xl font-black text-indigo-800 mb-2">ç†±ç²’é›å‹•ï¼šç§‘å­¸å¤§å†’éšª</h1>
                            <p className="text-indigo-600 font-bold">ç†±å­¸ x å…ƒç´  x åˆ†å­</p>
                        </div>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">ç­ç´š</label>
                                <input type="text" className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="ä¾‹å¦‚ï¼š801"
                                    value={info.class} onChange={e => setInfo({...info, class: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">åº§è™Ÿ</label>
                                <input type="number" className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="ä¾‹å¦‚ï¼š15"
                                    value={info.number} onChange={e => setInfo({...info, number: e.target.value})} />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">å§“å</label>
                                <input type="text" className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="çœŸå¯¦å§“å"
                                    value={info.name} onChange={e => setInfo({...info, name: e.target.value})} />
                            </div>
                            <button onClick={handleSubmit} className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold text-lg hover:bg-indigo-700 transition mt-6 flex items-center justify-center gap-2">
                                é–‹å§‹æŒ‘æˆ° <Icon name="Play" />
                            </button>
                        </div>
                        <CopyrightFooter />
                    </div>
                </div>
            );
        };

        // åœ–ç‰‡é¡¯ç¤ºå…ƒä»¶ (ä½¿ç”¨ React State ç®¡ç†éŒ¯èª¤ç‹€æ…‹ï¼Œä¸¦èª¿æ•´ç‚º object-contain)
        const ImageDisplay = ({ src, alt, className="" }) => {
            const [error, setError] = useState(false);

            useEffect(() => {
                setError(false);
            }, [src]);

            if (error) {
                return (
                    <div className={`overflow-hidden rounded-xl shadow-md border-2 border-orange-100 bg-gray-100 flex items-center justify-center text-gray-400 flex-col ${className}`}>
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mb-2">
                            <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                        </svg>
                        <span className="text-sm">åœ–ç‰‡è¼‰å…¥å¤±æ•—</span>
                    </div>
                );
            }

            return (
                <div className={`overflow-hidden rounded-xl shadow-md border-2 border-orange-100 ${className}`}>
                    <img 
                        src={src} 
                        alt={alt}
                        className="w-full h-full object-contain bg-white" 
                        onError={() => setError(true)}
                    />
                </div>
            );
        };

        // --- ç¬¬ä¸€é—œï¼šçƒ¤é› (ç†±å­¸) ---
        const Level1_Chicken = ({ onComplete }) => {
            const [state, setState] = useState('intro'); // intro, game, result
            const [qIdx, setQIdx] = useState(0);
            const [score, setScore] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const [answers, setAnswers] = useState([]);

            const handleAnswer = (option) => {
                if (feedback) return;
                setFeedback(option);
                const isCorrect = option.correct;
                if (isCorrect) setScore(s => s + 20); // æ¯é¡Œ20åˆ†ï¼Œå…±5é¡Œ100åˆ†
                
                // ç´€éŒ„
                const newAnswers = [...answers, {
                    q: CHICKEN_QUESTIONS[qIdx].title,
                    userAns: option.text,
                    isCorrect: isCorrect
                }];
                setAnswers(newAnswers);
            };

            const next = () => {
                setFeedback(null);
                if (qIdx + 1 < CHICKEN_QUESTIONS.length) {
                    setQIdx(qIdx + 1);
                } else {
                    setState('result');
                }
            };

            const finishLevel = () => {
                onComplete(score, answers);
            };

            if (state === 'intro') {
                return (
                     <div className="max-w-2xl mx-auto p-4 fade-in">
                        <div className="bg-white rounded-2xl shadow-xl overflow-hidden text-center p-8 space-y-6 border-4 border-orange-200 relative">
                            <h2 className="text-3xl font-black text-orange-600">ç¬¬ä¸€é—œï¼šç´™ç®±çƒ¤é›å¤§æŒ‘æˆ°</h2>
                            <ImageDisplay src={CHICKEN_IMAGES.intro} alt="çƒ¤å…¨é›" className="w-64 h-64 mx-auto" />
                            <p className="text-gray-600 text-lg">é‹ç”¨ä½ çš„ç†±å­¸çŸ¥è­˜ï¼Œçƒ¤å‡ºä¸€éš»å®Œç¾çš„è„†çš®çƒ¤é›å§ï¼</p>
                            <button onClick={() => setState('game')} className="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-8 rounded-full text-xl shadow-lg transition transform hover:scale-105">
                                é–‹å§‹çƒ¤é›
                            </button>
                            <CopyrightFooter />
                        </div>
                    </div>
                )
            }

            if (state === 'result') {
                const isSuccess = score >= 60; // 3é¡Œä»¥ä¸ŠåŠæ ¼
                return (
                     <div className="max-w-2xl mx-auto p-4 fade-in">
                        <div className="bg-white rounded-2xl shadow-xl overflow-hidden text-center p-8 space-y-6 border-4 border-orange-200 relative">
                            <h2 className="text-3xl font-black text-orange-600">çƒ¤é›æˆæœç™¼è¡¨</h2>
                            <ImageDisplay src={isSuccess ? CHICKEN_IMAGES.win : CHICKEN_IMAGES.lose} alt="çµæœ" className="w-64 h-64 mx-auto" />
                            <div className="text-4xl font-bold text-gray-800">{score} åˆ†</div>
                            <p className="text-gray-600 text-lg">{isSuccess ? "å¤ªæ£’äº†ï¼é€™æ˜¯ä¸€éš»å®Œç¾çš„è„†çš®çƒ¤é›ï¼" : "å“å‘€ï¼ç«å€™æ§åˆ¶ä¸ç•¶ï¼Œçƒ¤é›æ²’ç†Ÿ..."}</p>
                            <button onClick={finishLevel} className="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-8 rounded-full text-xl shadow-lg transition transform hover:scale-105">
                                å‰å¾€ä¸‹ä¸€é—œ
                            </button>
                            <CopyrightFooter />
                        </div>
                    </div>
                )
            }

            const q = CHICKEN_QUESTIONS[qIdx];

            return (
                <div className="max-w-2xl mx-auto p-4 fade-in">
                    <div className="bg-orange-500 p-4 rounded-t-2xl text-white flex justify-between items-center">
                        <h2 className="text-xl font-bold flex items-center gap-2"><Icon name="Flame" /> ç¬¬ä¸€é—œï¼šç´™ç®±çƒ¤é›</h2>
                        <span>ç¬¬ {qIdx + 1} / 5 é¡Œ</span>
                    </div>
                    <div className="bg-white p-6 rounded-b-2xl shadow-xl border-x-2 border-b-2 border-orange-100">
                        {/* ä¿®æ­£åœ–ç‰‡å¤§å°é™åˆ¶ï¼šmax-w-sm (ç´„ 24rem/384px) h-48 (12rem/192px) */}
                        <ImageDisplay src={CHICKEN_IMAGES[q.imgKey]} alt="ç¤ºæ„åœ–" className="w-full max-w-sm h-48 mx-auto mb-6" />
                        
                        <h3 className="text-xl font-bold text-gray-800 mb-2">{q.title}</h3>
                        <p className="text-gray-600 mb-6">{q.description}</p>
                        <div className="space-y-3">
                            {q.options.map((opt, i) => (
                                <button key={i} onClick={() => handleAnswer(opt)} disabled={!!feedback}
                                    className={`w-full text-left p-4 rounded-xl border-2 transition-all ${
                                        feedback 
                                        ? (opt.correct ? 'bg-green-100 border-green-500 text-green-800' : (feedback === opt ? 'bg-red-100 border-red-500 text-red-800' : 'opacity-50'))
                                        : 'hover:bg-orange-50 hover:border-orange-500 border-gray-100'
                                    }`}
                                >
                                    <span className="font-bold mr-2">{String.fromCharCode(65+i)}.</span> {opt.text}
                                </button>
                            ))}
                        </div>
                        {feedback && (
                            <div className="mt-4 p-4 bg-blue-50 text-blue-800 rounded-xl border border-blue-200 animate-pulse">
                                <p className="font-bold mb-1">{feedback.correct ? "ğŸ‰ æ­£ç¢ºï¼" : "ğŸ’¡ æç¤ºï¼š"}</p>
                                <p>{feedback.feedback}</p>
                                <button onClick={next} className="mt-3 w-full bg-slate-800 text-white py-2 rounded-lg">
                                    {qIdx < CHICKEN_QUESTIONS.length - 1 ? "ä¸‹ä¸€é¡Œ" : "æŸ¥çœ‹çµæœ"}
                                </button>
                            </div>
                        )}
                        <CopyrightFooter />
                    </div>
                </div>
            );
        };

        // --- ç¬¬äºŒé—œï¼šå…ƒç´  (åŒ–å­¸) ---
        const Level2_Element = ({ onComplete }) => {
            const [questions, setQuestions] = useState([]);
            const [qIdx, setQIdx] = useState(0);
            const [selectedTags, setSelectedTags] = useState(new Set());
            const [roundResult, setRoundResult] = useState(null);
            const [totalScore, setTotalScore] = useState(0);
            const [history, setHistory] = useState([]);

            useEffect(() => {
                // éš¨æ©Ÿå– 5 é¡Œ
                const shuffled = [...ELEMENTS_DB].sort(() => 0.5 - Math.random());
                setQuestions(shuffled.slice(0, 5));
            }, []);

            if (questions.length === 0) return <div>Loading...</div>;

            const currentQ = questions[qIdx];
            
            // åˆ†é¡ Tag
            const categories = {};
            const catOrder = ['å…ƒç´ ç¬¦è™Ÿ', 'ç‹€æ…‹', 'åˆ†é¡', 'å¤–è§€', 'æ€§è³ª <å¸¸æº«>', 'åŒ–å­¸/å…¶ä»–', 'ç”¨é€”/æˆåˆ†'];
            Object.values(ELEM_TAGS).forEach(tag => {
                if(!categories[tag.category]) categories[tag.category] = [];
                categories[tag.category].push(tag);
            });

            const toggleTag = (id) => {
                if (roundResult) return;
                const newSet = new Set(selectedTags);
                newSet.has(id) ? newSet.delete(id) : newSet.add(id);
                setSelectedTags(newSet);
            };

            const checkAnswer = () => {
                const correctIds = new Set(currentQ.tags.map(t => t.id));
                let score = 0;
                let details = { correct: [], missed: [], wrong: [] };

                selectedTags.forEach(id => {
                    if (correctIds.has(id)) { score += 2; details.correct.push(id); }
                    else { score -= 2; details.wrong.push(id); }
                });
                correctIds.forEach(id => {
                    if (!selectedTags.has(id)) { score -= 1; details.missed.push(id); }
                });

                setRoundResult({ score, details });
                setTotalScore(s => s + score);
                
                // ç´€éŒ„
                const newHistory = [...history, {
                    element: currentQ.name,
                    score: score,
                    details: details
                }];
                setHistory(newHistory);
            };

            const next = () => {
                if (qIdx < 4) {
                    setQIdx(qIdx + 1);
                    setSelectedTags(new Set());
                    setRoundResult(null);
                } else {
                    onComplete(totalScore + roundResult.score, [...history, {element: currentQ.name, score: roundResult.score}]);
                }
            };

            return (
                <div className="max-w-6xl mx-auto p-2 fade-in flex flex-col lg:flex-row gap-4 h-[calc(100vh-100px)]">
                     {/* å·¦å´ï¼šé¡Œç›®å¡ */}
                    <div className="w-full lg:w-1/3 flex flex-col">
                        <div className="bg-blue-600 text-white p-4 rounded-t-xl flex justify-between">
                            <h2 className="font-bold flex gap-2"><Icon name="Search" /> ç¬¬äºŒé—œï¼šå…ƒç´ å¤§æœæŸ¥</h2>
                            <span>{qIdx + 1}/5</span>
                        </div>
                        <div className="bg-white p-6 rounded-b-xl shadow-lg border border-blue-100 flex-1 flex flex-col justify-center items-center text-center">
                            <h3 className="text-5xl font-black text-gray-800 mb-2">{currentQ.name}</h3>
                            <p className="text-gray-400 text-sm mb-8">è«‹åœ¨å³å´é¸æ“‡æ‰€æœ‰ç¬¦åˆçš„æè¿°</p>
                            
                            {!roundResult ? (
                                <button onClick={checkAnswer} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold shadow-lg transition">é€å‡ºç­”æ¡ˆ</button>
                            ) : (
                                <div className="w-full">
                                    <div className={`p-4 rounded-lg font-bold text-xl mb-4 ${roundResult.score >= 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                        æœ¬é¡Œå¾—åˆ†ï¼š{roundResult.score}
                                    </div>
                                    <button onClick={next} className="w-full bg-gray-800 text-white py-4 rounded-xl font-bold shadow-lg">ä¸‹ä¸€é¡Œ</button>
                                </div>
                            )}
                            <CopyrightFooter />
                        </div>
                    </div>
                    {/* å³å´ï¼šé¸é …ç‰† (å¯æ²å‹•) */}
                    <div className="w-full lg:w-2/3 bg-white rounded-xl shadow-lg p-4 overflow-y-auto border border-blue-100">
                        <div className="space-y-6">
                            {catOrder.map(cat => (
                                <div key={cat} className="border-b pb-4">
                                    <h4 className="text-sm font-bold text-blue-500 mb-2 flex items-center gap-1"><div className="w-1 h-4 bg-blue-500 rounded"></div>{cat}</h4>
                                    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                                        {categories[cat]?.map(tag => {
                                            const isSel = selectedTags.has(tag.id);
                                            let style = "p-2 text-xs md:text-sm rounded border text-left transition relative ";
                                            if (roundResult) {
                                                if (roundResult.details.correct.includes(tag.id)) style += "bg-green-600 text-white border-green-700";
                                                else if (roundResult.details.missed.includes(tag.id)) style += "border-2 border-red-400 text-red-500 bg-red-50 border-dashed font-bold";
                                                else if (roundResult.details.wrong.includes(tag.id)) style += "bg-red-600 text-white border-red-700";
                                                else style += "opacity-30 bg-gray-100";
                                            } else {
                                                if (isSel) style += "bg-blue-500 text-white shadow-md transform scale-105 border-blue-600";
                                                else style += "hover:bg-blue-50 text-gray-700 bg-white border-gray-200";
                                            }
                                            return (
                                                <button key={tag.id} onClick={() => toggleTag(tag.id)} disabled={!!roundResult} className={style}>
                                                    {tag.text}
                                                    {roundResult?.details.correct.includes(tag.id) && <span className="absolute top-0 right-1 text-[10px] text-white opacity-80">+2</span>}
                                                    {roundResult?.details.missed.includes(tag.id) && <span className="absolute top-0 right-1 text-[10px] text-red-500">-1</span>}
                                                    {roundResult?.details.wrong.includes(tag.id) && <span className="absolute top-0 right-1 text-[10px] text-white opacity-80">-2</span>}
                                                </button>
                                            )
                                        })}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- ç¬¬ä¸‰é—œï¼šåˆ†å­ (å¾®è§€) ---
        const Level3_Molecule = ({ onComplete }) => {
            const [qList, setQList] = useState([]);
            const [qIdx, setQIdx] = useState(0);
            const [input, setInput] = useState({ model: '', count: '', name: '', cat: '', pure: '', atoms: '', types: '', molC: '', molT: '' });
            const [answers, setAnswers] = useState({});
            const [showReview, setShowReview] = useState(false); // æ–°å¢æª¢è¨ç‹€æ…‹

            // åŸå­ç¹ªåœ–å…ƒä»¶ (ä¿®æ­£ï¼šç§»é™¤æ–‡å­—)
            const AtomCircle = ({ type, size = 'sm' }) => {
                const s = MOL_ATOM_TYPES[type];
                const sz = size === 'lg' ? 'w-8 h-8' : (size === 'xs' ? 'w-5 h-5' : 'w-6 h-6'); // æ–°å¢ xs å°ºå¯¸
                return <div className={`${sz} ${s.color} rounded-full border shadow-sm shrink-0`}></div>; // ç§»é™¤ {type}
            };
            const ModelRender = ({ type }) => {
                if (type === '2H') return <div className="flex gap-2"><AtomCircle type="H"/><AtomCircle type="H"/></div>;
                if (type === '2Hâ‚‚') return <div className="flex gap-2"><div className="flex -space-x-1"><AtomCircle type="H"/><AtomCircle type="H"/></div><div className="flex -space-x-1"><AtomCircle type="H"/><AtomCircle type="H"/></div></div>;
                if (type === 'COâ‚‚') return <div className="flex -space-x-1"><AtomCircle type="O"/><AtomCircle type="C"/><AtomCircle type="O"/></div>;
                
                // ä¿®æ”¹æ°´åˆ†å­æ¯”ä¾‹ï¼šO æ­£å¸¸ (w-6 h-6 æˆ– w-8 h-8), H ç¸®å° (w-5 h-5)
                if (type === 'Hâ‚‚O') return (
                    <div className="relative w-10 h-9 flex justify-center items-center">
                        <div className="absolute top-0 z-10"><AtomCircle type="O" size="lg" /></div>
                        <div className="absolute bottom-0 left-0 z-20 transform -translate-x-1"><AtomCircle type="H" size="xs" /></div>
                        <div className="absolute bottom-0 right-0 z-20 transform translate-x-1"><AtomCircle type="H" size="xs" /></div>
                    </div>
                );
                
                if (type === 'O') return <AtomCircle type="O"/>;
                if (type === 'Oâ‚‚') return <div className="flex -space-x-1"><AtomCircle type="O"/><AtomCircle type="O"/></div>;
                
                if (type === '2Hâ‚‚O') return (
                    <div className="flex gap-2">
                        <ModelRender type="Hâ‚‚O"/>
                        <ModelRender type="Hâ‚‚O"/>
                    </div>
                );
                
                if (type === 'Hâ‚‚+COâ‚‚') return <div className="flex gap-2 items-center"><div className="flex -space-x-1"><AtomCircle type="H"/><AtomCircle type="H"/></div><div className="flex -space-x-1"><AtomCircle type="O"/><AtomCircle type="C"/><AtomCircle type="O"/></div></div>;
                return null;
            };

            // æ–°å¢ï¼šåœ–ä¾‹å…ƒä»¶ (ä¿®æ”¹ç‚ºå³ä¸Šè§’æ©«å‘æ’åˆ—)
            const Legend = () => (
                <div className="absolute top-4 right-4 bg-white/90 p-2 rounded-lg border shadow-sm text-xs flex gap-3 z-10">
                    <div className="flex items-center gap-1"><div className="w-4 h-4 rounded-full border bg-white border-gray-400"></div><span>H</span></div>
                    <div className="flex items-center gap-1"><div className="w-4 h-4 rounded-full border bg-gray-900 border-gray-700"></div><span>C</span></div>
                    <div className="flex items-center gap-1"><div className="w-4 h-4 rounded-full border bg-red-500 border-red-700"></div><span>O</span></div>
                </div>
            );

            useEffect(() => {
                const shuffled = [...MOL_QUESTIONS].sort(() => 0.5 - Math.random());
                setQList(shuffled);
            }, []);

            useEffect(() => {
                setInput({ model: '', count: '', name: '', cat: '', pure: '', atoms: '', types: '', molC: '', molT: '' });
            }, [qIdx]);

            if (qList.length === 0) return <div>Loading...</div>;
            
            // æª¢è¨ç•«é¢é‚è¼¯
            if (showReview) {
                const totalPoints = Object.values(answers).reduce((acc, c) => acc + c.pts, 0);
                
                return (
                    <div className="max-w-4xl mx-auto p-4 fade-in pb-20">
                         <div className="bg-white rounded-2xl shadow-lg p-8 border-t-8 border-indigo-500 relative">
                            <h2 className="text-2xl font-bold mb-6 text-center text-indigo-900">ç¬¬ä¸‰é—œä½œç­”æª¢è¨</h2>
                            <div className="text-center mb-8">
                                <span className="text-5xl font-black text-indigo-600">{totalPoints}</span> <span className="text-gray-500">/ {qList.length * 13} åˆ†</span>
                            </div>
                            
                            <div className="space-y-6">
                                {qList.map((q, idx) => {
                                    const ans = answers[q.id];
                                    if (!ans) return null;
                                    const isFullScore = ans.pts === ans.max;
                                    
                                    return (
                                        <div key={idx} className="border rounded-xl overflow-hidden">
                                            <div className={`px-4 py-2 flex justify-between font-bold ${isFullScore ? 'bg-green-100 text-green-800' : 'bg-red-50 text-red-800'}`}>
                                                <span>é¡Œç›®ï¼š{q.symbol}</span>
                                                <span>å¾—åˆ†ï¼š{ans.pts}</span>
                                            </div>
                                            <div className="p-4 bg-white grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                                <div>
                                                    <div className="font-bold text-gray-500 mb-2">æ¨¡å‹é¸æ“‡</div>
                                                    <div className="flex items-center gap-4">
                                                        <div className="text-center">
                                                            <div className="text-xs text-gray-400 mb-1">ä½ çš„ç­”æ¡ˆ</div>
                                                            <div className="p-2 border rounded">
                                                                <ModelRender type={MOL_OPTIONS.find(o=>o.id===ans.user.model)?.type} />
                                                            </div>
                                                        </div>
                                                        <div className="text-center">
                                                            <div className="text-xs text-gray-400 mb-1">æ­£ç¢ºç­”æ¡ˆ</div>
                                                            <div className="p-2 border rounded border-green-500 bg-green-50">
                                                                <ModelRender type={MOL_OPTIONS.find(o=>o.id===q.correctModelId)?.type} />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div className="font-bold text-gray-500 mb-2">æ•¸æ“šæ¯”å° (ä½ çš„ / æ­£ç¢º)</div>
                                                    <div className="grid grid-cols-2 gap-x-4 gap-y-1">
                                                        <div className={ans.user.count == q.correct.count ? "text-green-600" : "text-red-600"}>æ•¸é‡: {ans.user.count} / {q.correct.count}</div>
                                                        <div className={ans.user.name === q.correct.name ? "text-green-600" : "text-red-600"}>{ans.user.name}</div>
                                                        <div className={ans.user.cat === q.correct.category ? "text-green-600" : "text-red-600"}>åˆ†é¡: {ans.user.cat} / {q.correct.category}</div>
                                                        <div className={ans.user.pure === q.correct.purity ? "text-green-600" : "text-red-600"}>{ans.user.pure}</div>
                                                        <div className={parseInt(ans.user.atoms) === q.correct.composition.totalAtoms ? "text-green-600" : "text-red-600"}>åŸå­ç¸½æ•¸: {ans.user.atoms} / {q.correct.composition.totalAtoms}</div>
                                                        <div className={parseInt(ans.user.types) === q.correct.composition.atomTypes ? "text-green-600" : "text-red-600"}>åŸå­ç¨®é¡: {ans.user.types} / {q.correct.composition.atomTypes}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>

                            <button 
                                onClick={() => onComplete(totalPoints, answers)}
                                className="w-full mt-8 bg-indigo-800 text-white py-4 rounded-xl font-bold text-xl shadow-lg hover:bg-indigo-900 transition"
                            >
                                æŸ¥çœ‹ç¸½æˆç¸¾ä¸¦ä¸Šå‚³
                            </button>
                            <CopyrightFooter />
                        </div>
                    </div>
                )
            }

            const q = qList[qIdx];

            const handleNext = () => {
                let pts = 0;
                if (input.model === q.correctModelId) pts += 5;
                if (parseInt(input.count) === q.correct.count) pts += 1;
                if (input.name === q.correct.name) pts += 1;
                if (input.cat === q.correct.category) pts += 1;
                if (input.pure === q.correct.purity) pts += 1;
                if (parseInt(input.atoms) === q.correct.composition.totalAtoms) pts += 1;
                if (parseInt(input.types) === q.correct.composition.atomTypes) pts += 1;
                if (parseInt(input.molC) === q.correct.composition.moleculeCount) pts += 1;
                if (parseInt(input.molT) === q.correct.composition.moleculeTypes) pts += 1;

                const newAns = { ...answers, [q.id]: { q: q.symbol, pts, max: 13, user: input, correct: q } };
                setAnswers(newAns);

                if (qIdx < qList.length - 1) {
                    setQIdx(qIdx + 1);
                } else {
                    // å…¨éƒ¨ä½œç­”å®Œç•¢ï¼Œé€²å…¥æª¢è¨
                    setShowReview(true);
                }
            };

            return (
                <div className="max-w-4xl mx-auto p-4 fade-in pb-20">
                    <div className="bg-indigo-600 text-white p-4 rounded-t-xl flex justify-between">
                        <h2 className="font-bold flex gap-2"><Icon name="ZoomIn" /> ç¬¬ä¸‰é—œï¼šç¸®å°ç‡ˆå¤§å†’éšª</h2>
                        <span>{qIdx + 1} / {qList.length}</span>
                    </div>
                    
                    <div className="bg-white p-6 rounded-b-xl shadow-lg border-x border-b border-indigo-100 relative">
                        <Legend /> {/* Moved here */}
                        
                        {/* é¡Œç›® */}
                        <div className="text-center mb-6">
                            <h3 className="text-4xl font-black text-indigo-900 mb-2">{q.symbol}</h3>
                            <p className="text-sm text-gray-500">è«‹é¸å‡ºæ­£ç¢ºæ¨¡å‹ä¸¦å¡«å¯«æ€§è³ª</p>
                        </div>

                        {/* æ¨¡å‹é¸æ“‡ */}
                        <div className="relative p-2 border border-gray-100 rounded-xl bg-gray-50 mb-6">
                            <div className="grid grid-cols-4 gap-2">
                                {MOL_OPTIONS.map(opt => (
                                    <button key={opt.id} onClick={() => setInput({...input, model: opt.id})}
                                        className={`h-24 border rounded-lg flex items-center justify-center relative transition-all ${input.model === opt.id ? 'bg-indigo-50 border-indigo-500 ring-2 ring-indigo-200 transform scale-105 z-10' : 'hover:bg-white bg-white'}`}>
                                        <ModelRender type={opt.type} />
                                        {input.model === opt.id && <div className="absolute top-1 right-1 text-indigo-500"><Icon name="CheckCircle" size={14}/></div>}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* å¡«ç­”å€ */}
                        <div className="grid md:grid-cols-2 gap-4 text-sm">
                            <div className="bg-yellow-50 p-4 rounded-lg space-y-3">
                                <h4 className="font-bold text-yellow-800">1. åŸºæœ¬è­˜åˆ¥</h4>
                                <div className="flex items-center gap-2">
                                    <span>æœ‰</span>
                                    <input type="number" className="w-12 p-1 border rounded text-center" value={input.count} onChange={e=>setInput({...input, count: e.target.value})}/>
                                    <span>å€‹</span>
                                    <select className="p-1 border rounded w-32" value={input.name} onChange={e=>setInput({...input, name: e.target.value})}>
                                        <option value="">é¸æ“‡...</option>
                                        <option value="æ°«åŸå­">æ°«åŸå­</option><option value="æ°«åˆ†å­">æ°«åˆ†å­</option>
                                        <option value="æ°§åŸå­">æ°§åŸå­</option><option value="æ°§åˆ†å­">æ°§åˆ†å­</option>
                                        <option value="æ°´åˆ†å­">æ°´åˆ†å­</option><option value="äºŒæ°§åŒ–ç¢³åˆ†å­">äºŒæ°§åŒ–ç¢³åˆ†å­</option>
                                        <option value="æ··åˆç‰©(æœ‰å¹¾å€‹ç‰©è³ª)">æ··åˆç‰©(æœ‰å¹¾å€‹ç‰©è³ª)</option>
                                    </select>
                                </div>
                            </div>

                            <div className="bg-green-50 p-4 rounded-lg space-y-3">
                                <h4 className="font-bold text-green-800">2. åˆ†é¡</h4>
                                <div className="flex gap-1">
                                    {['å…ƒç´ ','åŒ–åˆç‰©','ä¸é©ç”¨'].map(o=><button key={o} onClick={()=>setInput({...input, cat: o})} className={`flex-1 py-1 rounded border ${input.cat===o?'bg-green-600 text-white':'bg-white'}`}>{o}</button>)}
                                </div>
                                <div className="flex gap-1">
                                    {['ç´”ç‰©è³ª','æ··åˆç‰©'].map(o=><button key={o} onClick={()=>setInput({...input, pure: o})} className={`flex-1 py-1 rounded border ${input.pure===o?'bg-green-600 text-white':'bg-white'}`}>{o}</button>)}
                                </div>
                            </div>

                            <div className="bg-purple-50 p-4 rounded-lg col-span-full grid grid-cols-2 md:grid-cols-4 gap-4">
                                <h4 className="font-bold text-purple-800 col-span-full">3. å¾®è§€è¨ˆæ•¸</h4>
                                <label className="block">åŸå­ç¸½æ•¸ <input type="number" className="w-full mt-1 p-1 border rounded text-center" value={input.atoms} onChange={e=>setInput({...input, atoms: e.target.value})}/></label>
                                <label className="block">åŸå­ç¨®é¡ <input type="number" className="w-full mt-1 p-1 border rounded text-center" value={input.types} onChange={e=>setInput({...input, types: e.target.value})}/></label>
                                <label className="block">åˆ†å­å€‹æ•¸ <input type="number" className="w-full mt-1 p-1 border rounded text-center" value={input.molC} onChange={e=>setInput({...input, molC: e.target.value})}/></label>
                                <label className="block">åˆ†å­ç¨®é¡ <input type="number" className="w-full mt-1 p-1 border rounded text-center" value={input.molT} onChange={e=>setInput({...input, molT: e.target.value})}/></label>
                            </div>
                        </div>

                        <button onClick={handleNext} className="w-full mt-6 bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg font-bold text-lg shadow-md">
                            {qIdx < qList.length - 1 ? 'ä¸‹ä¸€é¡Œ' : 'äº¤å·ä¸¦æª¢è¨'}
                        </button>
                        <CopyrightFooter />
                    </div>
                </div>
            );
        };

        // --- æœ€çµ‚ç¸½çµç•«é¢ ---
        const SummaryScreen = ({ userInfo, scores, details }) => {
            const [status, setStatus] = useState('idle');
            const totalScore = scores.l1 + scores.l2 + scores.l3;

            const handleUpload = async () => {
                if (!TEACHER_SCRIPT_URL) {
                    alert('è«‹é€šçŸ¥è€å¸«ï¼šå°šæœªè¨­å®š Google Apps Script ç¶²å€ï¼');
                    return;
                }
                setStatus('uploading');
                
                const payload = {
                    timestamp: new Date().toISOString(),
                    class: userInfo.class,
                    number: userInfo.number,
                    name: userInfo.name,
                    totalScore: totalScore,
                    l1_score: scores.l1,
                    l2_score: scores.l2,
                    l3_score: scores.l3,
                    details: JSON.stringify(details)
                };

                try {
                    await fetch(TEACHER_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify(payload)
                    });
                    setStatus('success');
                } catch (e) {
                    console.error(e);
                    setStatus('error');
                }
            };

            return (
                <div className="max-w-3xl mx-auto p-4 fade-in pb-20">
                    <div className="bg-white rounded-2xl shadow-2xl overflow-hidden relative">
                        <div className="bg-slate-800 text-white p-8 text-center">
                            <h2 className="text-3xl font-bold mb-2">å…¨é—œå¡æŒ‘æˆ°å®Œæˆï¼</h2>
                            <p className="opacity-80">{userInfo.class}ç­ {userInfo.number}è™Ÿ {userInfo.name}</p>
                            <div className="mt-6 text-7xl font-black text-yellow-400">{totalScore} <span className="text-xl text-white font-normal">åˆ†</span></div>
                        </div>

                        <div className="p-8 space-y-6">
                            {/* åˆ†æ•¸ç´°é … */}
                            <div className="grid grid-cols-3 gap-4 text-center">
                                <div className="p-4 bg-orange-50 rounded-xl border border-orange-100">
                                    <div className="text-gray-500 text-sm mb-1">ç´™ç®±çƒ¤é›</div>
                                    <div className="text-2xl font-bold text-orange-600">{scores.l1}</div>
                                </div>
                                <div className="p-4 bg-blue-50 rounded-xl border border-blue-100">
                                    <div className="text-gray-500 text-sm mb-1">å…ƒç´ æœæŸ¥</div>
                                    <div className="text-2xl font-bold text-blue-600">{scores.l2}</div>
                                </div>
                                <div className="p-4 bg-indigo-50 rounded-xl border border-indigo-100">
                                    <div className="text-gray-500 text-sm mb-1">ç¸®å°ç‡ˆ</div>
                                    <div className="text-2xl font-bold text-indigo-600">{scores.l3}</div>
                                </div>
                            </div>

                            {/* ä¸Šå‚³æŒ‰éˆ• */}
                            <div className="border-t pt-6">
                                {status === 'idle' && (
                                    <button onClick={handleUpload} className="w-full bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-xl shadow-lg flex items-center justify-center gap-2">
                                        <Icon name="UploadCloud" /> ä¸Šå‚³æˆç¸¾è‡³é›²ç«¯
                                    </button>
                                )}
                                {status === 'uploading' && (
                                    <button disabled className="w-full bg-gray-400 text-white py-4 rounded-xl font-bold text-xl flex items-center justify-center gap-2 cursor-wait">
                                        <Icon name="Loader2" className="animate-spin" /> ä¸Šå‚³ä¸­...
                                    </button>
                                )}
                                {status === 'success' && (
                                    <div className="w-full bg-green-100 text-green-700 py-4 rounded-xl font-bold text-xl text-center border border-green-300 flex items-center justify-center gap-2">
                                        <Icon name="CheckCircle" /> ä¸Šå‚³æˆåŠŸï¼
                                    </div>
                                )}
                                {status === 'error' && (
                                    <div className="w-full bg-red-100 text-red-700 py-4 rounded-xl font-bold text-xl text-center border border-red-300 flex items-center justify-center gap-2">
                                        <Icon name="AlertTriangle" /> ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯
                                    </div>
                                )}
                            </div>
                            
                            <div className="text-center">
                                <p className="text-gray-400 text-sm">ç¢ºèªä¸Šå‚³æˆåŠŸå¾Œï¼Œå³å¯é—œé–‰ç¶²é </p>
                            </div>
                            <CopyrightFooter />
                        </div>
                    </div>
                </div>
            );
        };

        // ============================================================================
        // ä¸»ç¨‹å¼ (Main App)
        // ============================================================================
        const App = () => {
            const [phase, setPhase] = useState('login'); // login, l1, l2, l3, summary
            const [user, setUser] = useState({});
            const [scores, setScores] = useState({ l1: 0, l2: 0, l3: 0 });
            const [details, setDetails] = useState({ l1: [], l2: [], l3: {} });

            const handleLogin = (info) => {
                setUser(info);
                setPhase('l1');
            };

            const finishL1 = (score, ans) => {
                setScores(s => ({ ...s, l1: score }));
                setDetails(d => ({ ...d, l1: ans }));
                setPhase('l2');
            };

            const finishL2 = (score, history) => {
                setScores(s => ({ ...s, l2: score }));
                setDetails(d => ({ ...d, l2: history }));
                setPhase('l3');
            };

            const finishL3 = (score, ansMap) => {
                setScores(s => ({ ...s, l3: score }));
                setDetails(d => ({ ...d, l3: ansMap }));
                setPhase('summary');
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800">
                    {/* Header (Login å¾Œé¡¯ç¤º) */}
                    {phase !== 'login' && (
                        <div className="sticky top-0 z-50 bg-white/90 backdrop-blur border-b shadow-sm px-4 py-3 flex justify-between items-center">
                            <div className="font-bold text-slate-700 flex items-center gap-2">
                                <span className="bg-slate-200 px-2 py-1 rounded text-xs text-slate-600">{user.class}ç­ {user.number}è™Ÿ</span>
                                <span>{user.name}</span>
                            </div>
                            <div className="flex gap-4 items-center">
                                <HeaderCredit />
                                <div className="flex gap-2">
                                    <div className={`h-2 w-2 rounded-full ${phase==='l1'?'bg-orange-500 animate-pulse':'bg-gray-300'}`}></div>
                                    <div className={`h-2 w-2 rounded-full ${phase==='l2'?'bg-blue-500 animate-pulse':'bg-gray-300'}`}></div>
                                    <div className={`h-2 w-2 rounded-full ${phase==='l3'?'bg-indigo-500 animate-pulse':'bg-gray-300'}`}></div>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="container mx-auto">
                        {phase === 'login' && <LoginScreen onLogin={handleLogin} />}
                        {phase === 'l1' && <Level1_Chicken onComplete={finishL1} />}
                        {phase === 'l2' && <Level2_Element onComplete={finishL2} />}
                        {phase === 'l3' && <Level3_Molecule onComplete={finishL3} />}
                        {phase === 'summary' && <SummaryScreen userInfo={user} scores={scores} details={details} />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>